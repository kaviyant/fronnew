<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Owner Dashboard</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      padding: 40px;
      max-width: 800px;
      margin: auto;
      background: #f7f7f7;
    }
    input, button {
      padding: 10px;
      margin: 8px;
      border-radius: 8px;
      border: 1px solid #ccc;
      width: calc(100% - 30px);
    }
    button {
      background: #2b8a3e;
      color: white;
      border: none;
      cursor: pointer;
    }
    ul {
      padding: 0;
      list-style: none;
    }
    li {
      margin: 10px 0;
      background: white;
      padding: 10px;
      border-radius: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .item-details {
      flex-grow: 1;
      text-align: left;
    }
    img {
      max-width: 200px;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <h2>üõí Owner Menu Dashboard</h2>
  <input type="text" id="foodName" placeholder="Food name">
  <input type="number" id="foodPrice" placeholder="Price">
  <input type="number" id="foodCount" placeholder="Available Count">
  <input type="text" id="shopID" placeholder="Your Shop ID">
  <button onclick="addItem()">Add Item</button>
  <button onclick="fetchMenu()">üîÑ Refresh Menu</button>

  <h3>üìã Current Menu</h3>
  <ul id="menuList"></ul>

  <h3>üì± QR Code</h3>
  <img id="qrCode" />

  <script>
    const backend = "https://qrnew-z3il.onrender.com";  // ‚úÖ your live backend
    let shopID = '';

    async function fetchMenu() {
      if (!shopID) shopID = document.getElementById("shopID").value;
      if (!shopID) return alert("Enter your Shop ID first!");

      try {
        const res = await fetch(`${backend}/api/menu?shopID=${shopID}`);
        const menu = await res.json();
        const list = document.getElementById("menuList");
        list.innerHTML = "";

        menu.forEach(item => {
          const li = document.createElement("li");
          li.innerHTML = `
            <div class="item-details">
              <strong>${item.name}</strong> - ‚Çπ${item.price} | Count: ${item.count}
            </div>
            <div>
              <button onclick="editItem('${item._id}', '${item.name}', ${item.price}, ${item.count})">‚úèÔ∏è</button>
              <button onclick="deleteItem('${item._id}')">üóëÔ∏è</button>
            </div>`;
          list.appendChild(li);
        });

        document.getElementById("qrCode").src = `${backend}/qr?shop=${shopID}`;
      } catch (err) {
        console.error("Failed to fetch menu:", err);
        alert("Could not load menu.");
      }
    }

    async function addItem() {
      const name = document.getElementById("foodName").value;
      const price = +document.getElementById("foodPrice").value;
      const count = +document.getElementById("foodCount").value;
      shopID = document.getElementById("shopID").value;

      if (!name || !price || !count || !shopID) return alert("All fields required!");

      try {
        await fetch(`${backend}/api/menu`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ name, price, count, shopID })
        });

        fetchMenu();
      } catch (err) {
        alert("Error adding item. Please try again.");
        console.error(err);
      }
    }

    async function deleteItem(id) {
      try {
        await fetch(`${backend}/api/menu/${id}`, { method: "DELETE" });
        fetchMenu();
      } catch (err) {
        alert("Failed to delete item.");
        console.error(err);
      }
    }

    async function editItem(id, name, price, count) {
      const newName = prompt("Edit name:", name);
      const newPrice = prompt("Edit price:", price);
      const newCount = prompt("Edit count:", count);

      if (newName && newPrice && newCount) {
        try {
          await fetch(`${backend}/api/menu/${id}`, {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ name: newName, price: +newPrice, count: +newCount })
          });
          fetchMenu();
        } catch (err) {
          alert("Failed to update item.");
          console.error(err);
        }
      }
    }
  </script>
</body>
</html>
