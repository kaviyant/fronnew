<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Owner Dashboard</title>
  <style>
    body { font-family: 'Segoe UI', sans-serif; padding: 40px; max-width: 800px; margin: auto; background: #f7f7f7; }
    input, button { padding: 10px; margin: 8px; border-radius: 8px; border: 1px solid #ccc; width: calc(100% - 30px); }
    button { background: #2b8a3e; color: white; border: none; cursor: pointer; }
    ul { padding: 0; list-style: none; }
    li { margin: 10px 0; background: white; padding: 10px; border-radius: 8px; display: flex; justify-content: space-between; align-items: center; }
    .item-details { flex-grow: 1; text-align: left; }
    img { max-width: 200px; margin-top: 20px; }
  </style>
</head>
<body>
  <h2>üõí Owner Menu Dashboard</h2>
  <input type="text" id="foodName" placeholder="Food name">
  <input type="number" id="foodPrice" placeholder="Price">
  <input type="number" id="foodCount" placeholder="Available Count">
  <input type="text" id="shopID" placeholder="Your Shop ID">
  <button onclick="addItem()">Add Item</button>

  <h3>üìã Current Menu</h3>
  <ul id="menuList"></ul>

  <h3>üì± QR Code</h3>
  <img id="qrCode" />

  <script>
    let shopID = '';

    async function fetchMenu() {
      if (!shopID) return;

      const res = await fetch(`http://localhost:5000/api/menu/${shopID}`);
      const menu = await res.json();
      const list = document.getElementById("menuList");
      list.innerHTML = "";

      menu.forEach(item => {
        const li = document.createElement("li");
        li.innerHTML = `
          <div class="item-details">
            <strong>${item.name}</strong> - ‚Çπ${item.price} | Count: ${item.count}
          </div>
          <div>
            <button onclick="editItem('${item._id}', '${item.name}', ${item.price}, ${item.count})">‚úèÔ∏è</button>
            <button onclick="deleteItem('${item._id}')">üóëÔ∏è</button>
          </div>`;
        list.appendChild(li);
      });
    }

    async function addItem() {
      const name = document.getElementById("foodName").value;
      const price = +document.getElementById("foodPrice").value;
      const count = +document.getElementById("foodCount").value;
      shopID = document.getElementById("shopID").value;

      if (!name || !price || !count || !shopID) return alert("All fields required!");

      await fetch("http://localhost:5000/api/menu", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ name, price, count, shopID })
      });

      document.getElementById("qrCode").src = `http://localhost:5000/qr?shop=${shopID}`;
      fetchMenu();
    }

    async function deleteItem(id) {
      await fetch(`http://localhost:5000/api/menu/${id}`, { method: "DELETE" });
      fetchMenu();
    }

    async function editItem(id, name, price, count) {
      const newName = prompt("Edit name:", name);
      const newPrice = prompt("Edit price:", price);
      const newCount = prompt("Edit count:", count);

      if (newName && newPrice && newCount) {
        await fetch(`http://localhost:5000/api/menu/${id}`, {
          method: "PUT",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ name: newName, price: +newPrice, count: +newCount })
        });
        fetchMenu();
      }
    }
  </script>
</body>
</html>
